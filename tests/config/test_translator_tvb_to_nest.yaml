name: translator_tvb_to_nest
description: Test translation pipeline from TVB rates to NEST spikes
version: '1.0'
environment:
  mpi_command: mpirun
  timeout: 600
  base_directory: /home/tests
  temp_directory_prefix: test_tvb_to_nest
setup:
  create_directories:
  - temp_directory
  - '{temp_directory}/translation'
  - '{temp_directory}/translation/input'
  - '{temp_directory}/translation/output'
  - '{temp_directory}/log'
  copy_files:
  - source: tests/init_rates.npy
    destination: '{temp_directory}/init_rates.npy'
    required: false
  cleanup_on_exit: true
  environment_variables:
  - source: tests/init.sh
processes:
- name: tvb_to_nest_translator
  description: Main translation process converting TVB rates to NEST spikes
  script: nest_elephant_tvb/translation/tvb_to_nest.py
  mpi:
    processes: 2
  communication:
    type: file_pair
    input_file: translation/input/0.txt
    output_file: translation/output/0.txt
    role: translator
  execution:
    mode: background
    start_delay: 0
- name: tvb_rate_producer
  description: Simulates TVB rate data input
  script: nest_elephant_tvb/translation/test_file/test_input_tvb_to_nest.py
  mpi:
    processes: 1
  communication:
    type: file
    file: translation/input/0.txt
    role: producer
  arguments:
  - '{temp_directory}/translation/input/0.txt'
  - '1000.0'
  execution:
    mode: background
    start_delay: 0.5
- name: nest_spike_consumer
  description: Receives and validates NEST spike data
  script: nest_elephant_tvb/translation/test_file/test_receive_tvb_to_nest.py
  mpi:
    processes: 1
  communication:
    type: file
    file: translation/output/0.txt
    role: consumer
  arguments:
  - '{temp_directory}/translation/output/0.txt'
  execution:
    mode: background
    depends_on:
    - tvb_to_nest_translator
    start_delay: 1.0
execution:
  wait_for_all: true
  synchronization_delay: 2.0
  process_startup_interval: 0.5
validation:
  success_criteria:
    all_processes_exit_zero: true
    file_size_minimum:
      translation/output/0.txt: 100
    translation_data_flow: true
    rate_to_spike_conversion: true
    min_execution_time: 10.0
    max_execution_time: 120.0
  failure_actions:
    collect_logs: true
    preserve_temp_files: true
    dump_communication_files: true
    generate_debug_report: true
monitoring:
  check_interval: 1.0
  communication_file_monitoring: true
  process_health_checks: true
  translation_quality_checks: true
logging:
  level: DEBUG
  file: '{temp_directory}/log/tvb_to_nest_translation_test.log'
  include_process_output: true
  include_mpi_communication: true
  include_timing_data: true
  include_translation_metrics: true
